<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PSA代行 買取承認</title>
<style>
/* 基本スタイル */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.approval-container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 15px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    overflow: hidden;
}

/* ヘッダー */
.header {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    text-align: center;
    padding: 2rem;
}

.header h1 {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* コンテンツエリア */
.content {
    padding: 2rem;
}

/* 承認キー入力エリア */
.key-input-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    border: 2px solid #3498db;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
    display: block; /* 確実に表示させる */
}

.key-input-section h3 {
    color: #2c3e50;
    margin-bottom: 1rem;
    font-size: 1.3rem;
}

.key-input-container {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1rem;
}


#approvalKeyInput {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

#approvalKeyInput:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

#loadApprovalBtn {
    padding: 12px 24px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    min-width: 120px;
}

#loadApprovalBtn:hover {
    background: #2980b9;
    transform: translateY(-1px);
}

#loadApprovalBtn:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
    transform: none;
}

.key-help-text {
    font-size: 0.9rem;
    color: #7f8c8d;
    margin-top: 0.5rem;
}

/* デッドラインバナー */
.deadline-banner {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    position: relative;
    overflow: hidden;
}

.deadline-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    transition: width 1s ease;
}

.deadline-content {
    position: relative;
    z-index: 1;
    font-weight: 600;
    text-align: center;
}

/* 顧客情報 */
.customer-info {
    background: #ecf0f1;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border-left: 4px solid #27ae60;
}

.customer-info h3 {
    color: #2c3e50;
    margin-bottom: 1rem;
}

/* カードリスト */
.card-list {
    margin-bottom: 2rem;
}

.card-list h3 {
    color: #2c3e50;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
}

.card-item {
    background: white;
    border: 2px solid #ecf0f1;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
}

.card-item:hover {
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.card-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2c3e50;
}

.card-price {
    font-size: 1.3rem;
    font-weight: 700;
    color: #27ae60;
}

.card-details {
    margin-bottom: 1rem;
    color: #7f8c8d;
}

.card-details p {
    margin-bottom: 0.5rem;
}

.card-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.action-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    flex: 1;
    min-width: 80px;
}

.action-btn.approve {
    background: #27ae60;
    color: white;
}

.action-btn.approve:hover {
    background: #219a52;
}

.action-btn.reject {
    background: #e74c3c;
    color: white;
}

.action-btn.reject:hover {
    background: #c0392b;
}

.action-btn.selected {
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
    transform: scale(1.05);
}

/* 一括操作 */
.bulk-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.bulk-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    flex: 1;
    min-width: 120px;
}

.bulk-btn.approve {
    background: #27ae60;
    color: white;
}

.bulk-btn.reject {
    background: #e74c3c;
    color: white;
}

.bulk-btn.reset {
    background: #95a5a6;
    color: white;
}

.bulk-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* サマリー */
.summary-section {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
}

.summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: white;
    border-radius: 8px;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

/* 最終送信 */
.final-submit-section {
    text-align: center;
}

.final-submit-btn {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    padding: 16px 48px;
    border: none;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
}

.final-submit-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
}

.final-submit-btn:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* エラーメッセージ */
.error-message {
    background: #fadbd8;
    color: #721c24;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #e74c3c;
    margin-bottom: 2rem;
}

/* ローディング */
.loading-content {
    text-align: center;
    padding: 3rem;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #ecf0f1;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* モーダル */
.modal, .alert-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
}

.modal-content, .alert-content {
    background: white;
    margin: 10% auto;
    padding: 2rem;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-title, .alert-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #2c3e50;
}

.modal-message {
    margin-bottom: 1rem;
    line-height: 1.6;
}

.modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
}

.modal-btn, .alert-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.modal-btn.primary {
    background: #3498db;
    color: white;
}

.modal-btn.secondary {
    background: #95a5a6;
    color: white;
}

.alert-btn {
    background: #3498db;
    color: white;
    width: 100%;
    margin-top: 1rem;
}

.modal-btn:hover, .alert-btn:hover {
    transform: translateY(-1px);
}

/* ローディングオーバーレイ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
}

/* レスポンシブ */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }

    .header h1 {
        font-size: 1.8rem;
    }

    .content {
        padding: 1rem;
    }

    .key-input-container {
        flex-direction: column;
    }

    #approvalKeyInput {
        width: 100%;
    }

    .card-actions {
        flex-direction: column;
    }

    .bulk-actions {
        flex-direction: column;
    }

    .summary-stats {
        grid-template-columns: 1fr;
    }

    .modal-actions {
        flex-direction: column;
    }

    .modal-btn {
        width: 100%;
    }
}
</style>
</head>
<body>
<div class="approval-container">
<div class="header">
<h1>PSA代行 買取承認</h1>
<p>カード買取価格のご承認をお願いします</p>
</div>
<div class="content">

<!-- 承認キー入力セクション（最初に表示される画面） -->
<div id="keyInputSection" class="key-input-section">
<h3>承認キーを入力してください</h3>
<div class="key-input-container">
<input type="text" id="approvalKeyInput" placeholder="承認キーを入力..." maxlength="50">
<button id="loadApprovalBtn" onclick="loadApprovalData()">承認情報を読み込み</button>
</div>
<div class="key-help-text">
管理者から送信されたメールに記載されている承認キーを入力してください
</div>
</div>

<!-- 以下は承認データ読み込み後に表示されるセクション -->

<!-- 有効期限バナー -->
<div id="deadlineBanner" class="deadline-banner" style="display: none;">
<div class="deadline-progress"></div>
<div class="deadline-content"></div>
</div>

<!-- 顧客情報 -->
<div id="customerInfo" class="customer-info" style="display: none;"></div>

<!-- カード一覧 -->
<div id="cardsList" class="card-list" style="display: none;"></div>

<!-- 選択サマリ -->
<div id="summarySection" class="summary-section" style="display: none;">
<div class="bulk-actions">
<button class="bulk-btn approve" onclick="bulkSelectAll('approved')">全て承諾</button>
<button class="bulk-btn reject" onclick="bulkSelectAll('rejected')">全て拒否</button>
<button class="bulk-btn reset" onclick="bulkSelectAll('pending')">リセット</button>
</div>
<div id="summaryStats" class="summary-stats"></div>
</div>

<!-- 最終送信ボタン -->
<div id="finalSubmitSection" class="final-submit-section" style="display: none;">
<button id="finalSubmitBtn" class="final-submit-btn" disabled onclick="showFinalConfirmModal()">
 選択内容を送信する
</button>
</div>

<!-- エラーメッセージ（初期状態では完全に非表示） -->
<div id="errorMessage" class="error-message" style="display: none;">
<h3>エラー</h3>
<p id="errorText"></p>
</div>

<!-- ローディング -->
<div id="loadingSection" class="loading-content" style="display: none;">
<div class="spinner"></div>
<p>承認情報を読み込み中...</p>
</div>

</div>
</div>

<!-- モーダル類 -->
<div id="finalConfirmModal" class="modal">
<div class="modal-content">
<div class="modal-title">最終確認</div>
<div id="finalConfirmMessage" class="modal-message"></div>
<div class="modal-actions">
<button class="modal-btn primary" onclick="submitFinalResponse()">送信する</button>
<button class="modal-btn secondary" onclick="hideFinalConfirmModal()">キャンセル</button>
</div>
</div>
</div>

<div id="alertModal" class="alert-modal">
<div class="alert-content">
<div class="alert-icon" id="alertIcon">⚠️</div>
<div class="alert-title" id="alertTitle">選択が未完了です</div>
<div class="alert-message" id="alertMessage">すべてのカードを選択してください</div>
<button class="alert-btn" onclick="hideAlert()">確認</button>
</div>
</div>

<div id="loadingOverlay" class="loading-overlay" style="display: none;">
<div class="loading-content">
<div class="spinner"></div>
<p>送信中...</p>
</div>
</div>

<script>
// グローバル変数
let currentApprovalData = null;
let currentApprovalKey = null;

// ページ読み込み時の初期化
document.addEventListener('DOMContentLoaded', function() {
    console.log('顧客承認ページが読み込まれました');

    // エラーメッセージを初期状態では非表示にする
    hideError();

    // 他のセクションも初期状態では非表示にする
    document.getElementById('deadlineBanner').style.display = 'none';
    document.getElementById('customerInfo').style.display = 'none';
    document.getElementById('cardsList').style.display = 'none';
    document.getElementById('summarySection').style.display = 'none';
    document.getElementById('finalSubmitSection').style.display = 'none';
    document.getElementById('loadingSection').style.display = 'none';

    // URLパラメータから承認キーを取得（ある場合）
    const urlParams = new URLSearchParams(window.location.search);
    const urlKey = urlParams.get('id');

    if (urlKey && urlKey.trim()) {
        console.log('URLから承認キーを検出:', urlKey);
        document.getElementById('approvalKeyInput').value = urlKey.trim();
        // 自動で承認データを読み込み
        loadApprovalData();
    } else {
        // URLパラメータがない場合は承認キー入力画面を表示
        console.log('URLパラメータなし - 承認キー入力画面を表示');
        const keyInputSection = document.getElementById('keyInputSection');
        if (keyInputSection) {
            keyInputSection.style.display = 'block';
            keyInputSection.style.visibility = 'visible';
        }
    }

    // 承認キー入力セクションを確実に表示（フォールバック）
    const keyInputSection = document.getElementById('keyInputSection');
    if (keyInputSection) {
        keyInputSection.style.display = 'block';
        keyInputSection.style.visibility = 'visible';
    }

    // Enterキーでの送信対応
    document.getElementById('approvalKeyInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            loadApprovalData();
        }
    });

    console.log('初期化完了 - 承認キー入力待機');
});

// 承認データ読み込み関数
async function loadApprovalData() {
    const keyInput = document.getElementById('approvalKeyInput');
    const approvalKey = keyInput.value.trim();

    if (!approvalKey) {
        showError('承認キーを入力してください。');
        return;
    }

    console.log('承認データを読み込み中:', approvalKey);

    // ローディング表示
    showLoading(true);
    hideError();

    try {
        const response = await fetch(`/api/approval/${approvalKey}`);
        const data = await response.json();

        console.log('サーバーレスポンス:', data);

        if (response.ok && data.success) {
            currentApprovalData = data.data;
            currentApprovalKey = approvalKey;
            displayApprovalData(data.data);
            console.log('承認データの読み込み完了');
        } else {
            showError(data.message || '承認情報の取得に失敗しました。承認キーを確認してください。');
            console.error('承認データ取得エラー:', data.message);
            // エラー時は承認キー入力セクションを再表示
            document.getElementById('keyInputSection').style.display = 'block';
        }
    } catch (error) {
        console.error('承認データ取得エラー:', error);
        showError('サーバーとの通信に失敗しました。しばらくしてから再度お試しください。');
        // エラー時は承認キー入力セクションを再表示
        document.getElementById('keyInputSection').style.display = 'block';
    } finally {
        showLoading(false);
    }
}

// 承認データ表示
function displayApprovalData(data) {
    console.log('承認データを表示:', data);

    // 承認キー入力セクションを非表示
    document.getElementById('keyInputSection').style.display = 'none';

    displayDeadline(data.deadline);
    displayCustomerInfo(data.customer);
    displayCardsList(data.cards);
    displaySummarySection();
    displayFinalSubmitSection();
    updateSummaryStats();
}

// デッドライン表示
function displayDeadline(deadline) {
    if (!deadline) return;

    const banner = document.getElementById('deadlineBanner');
    const content = banner.querySelector('.deadline-content');
    const progress = banner.querySelector('.deadline-progress');

    const deadlineDate = new Date(deadline);
    const now = new Date();
    const timeLeft = deadlineDate - now;

    if (timeLeft > 0) {
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

        content.innerHTML = `⏰ 承認期限: ${hours}時間${minutes}分後 (${deadlineDate.toLocaleString('ja-JP')})`;

        const totalTime = 24 * 60 * 60 * 1000;
        const elapsedTime = totalTime - timeLeft;
        const progressPercent = Math.min((elapsedTime / totalTime) * 100, 100);
        progress.style.width = `${progressPercent}%`;

        banner.style.display = 'block';
    } else {
        content.innerHTML = '⚠️ 承認期限が過ぎています';
        progress.style.width = '100%';
        banner.style.display = 'block';
    }
}

// 顧客情報表示
function displayCustomerInfo(customer) {
    const section = document.getElementById('customerInfo');
    section.innerHTML = `
        <h3>お客様情報</h3>
        <p><strong>お名前:</strong> ${customer.name || '未設定'}</p>
        <p><strong>メールアドレス:</strong> ${customer.email || '未設定'}</p>
        <p><strong>電話番号:</strong> ${customer.phone || '未設定'}</p>
    `;
    section.style.display = 'block';
}

// カードリスト表示
function displayCardsList(cards) {
    const section = document.getElementById('cardsList');
    let html = '<h3>カード一覧</h3>';

    if (!cards || cards.length === 0) {
        html += '<p>カード情報がありません。</p>';
        section.innerHTML = html;
        section.style.display = 'block';
        return;
    }

    cards.forEach((card, index) => {
        html += `
            <div class="card-item" data-index="${index}">
                <div class="card-header">
                    <div class="card-title">${card.name || `カード ${index + 1}`}</div>
                    <div class="card-price">¥${(card.price || 0).toLocaleString()}</div>
                </div>
                <div class="card-details">
                    <p><strong>グレード:</strong> ${card.grade || '未設定'}</p>
                    <p><strong>コンディション:</strong> ${card.condition || '未設定'}</p>
                    <p><strong>備考:</strong> ${card.notes || 'なし'}</p>
                </div>
                <div class="card-actions">
                    <button class="action-btn approve" onclick="selectCard(${index}, 'approved')">
                        承諾 (¥${(card.price || 0).toLocaleString()})
                    </button>
                    <button class="action-btn reject" onclick="selectCard(${index}, 'rejected')">
                        拒否
                    </button>
                </div>
            </div>
        `;
    });

    section.innerHTML = html;
    section.style.display = 'block';
}

// カード選択
function selectCard(index, status) {
    if (!currentApprovalData) return;

    currentApprovalData.cards[index].status = status;

    const cardItem = document.querySelector(`[data-index="${index}"]`);
    const buttons = cardItem.querySelectorAll('.action-btn');

    buttons.forEach(btn => btn.classList.remove('selected'));

    if (status === 'approved') {
        buttons[0].classList.add('selected');
    } else if (status === 'rejected') {
        buttons[1].classList.add('selected');
    }

    updateSummaryStats();
    updateFinalSubmitButton();
}

// 一括選択
function bulkSelectAll(status) {
    if (!currentApprovalData) return;

    currentApprovalData.cards.forEach((card, index) => {
        card.status = status;
        selectCard(index, status);
    });
}

// サマリー統計更新
function updateSummaryStats() {
    if (!currentApprovalData) return;

    const stats = {
        total: currentApprovalData.cards.length,
        approved: 0,
        rejected: 0,
        pending: 0,
        totalPrice: 0,
        approvedPrice: 0
    };

    currentApprovalData.cards.forEach(card => {
        stats.totalPrice += card.price || 0;

        if (card.status === 'approved') {
            stats.approved++;
            stats.approvedPrice += card.price || 0;
        } else if (card.status === 'rejected') {
            stats.rejected++;
        } else {
            stats.pending++;
        }
    });

    const section = document.getElementById('summaryStats');
    section.innerHTML = `
        <div class="stat-item">
            <div class="stat-number" style="color: #3498db;">${stats.total}</div>
            <div class="stat-label">総カード数</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" style="color: #27ae60;">${stats.approved}</div>
            <div class="stat-label">承諾</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" style="color: #e74c3c;">${stats.rejected}</div>
            <div class="stat-label">拒否</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" style="color: #f39c12;">${stats.pending}</div>
            <div class="stat-label">未選択</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" style="color: #27ae60;">¥${stats.approvedPrice.toLocaleString()}</div>
            <div class="stat-label">承諾金額</div>
        </div>
    `;
}

// 最終送信ボタン更新
function updateFinalSubmitButton() {
    if (!currentApprovalData) return;

    const pendingCount = currentApprovalData.cards.filter(card => !card.status || card.status === 'pending').length;
    const submitBtn = document.getElementById('finalSubmitBtn');

    if (pendingCount === 0) {
        submitBtn.disabled = false;
        submitBtn.textContent = '選択内容を送信する';
    } else {
        submitBtn.disabled = true;
        submitBtn.textContent = `未選択のカードがあります (${pendingCount}件)`;
    }
}

// 最終確認モーダル表示
function showFinalConfirmModal() {
    if (!currentApprovalData) return;

    const approved = currentApprovalData.cards.filter(card => card.status === 'approved');
    const rejected = currentApprovalData.cards.filter(card => card.status === 'rejected');
    const totalPrice = approved.reduce((sum, card) => sum + (card.price || 0), 0);

    const message = `
        <p><strong>承諾:</strong> ${approved.length}件 (¥${totalPrice.toLocaleString()})</p>
        <p><strong>拒否:</strong> ${rejected.length}件</p>
        <br>
        <p>この内容で承認を送信しますか？</p>
    `;

    document.getElementById('finalConfirmMessage').innerHTML = message;
    document.getElementById('finalConfirmModal').style.display = 'block';
}

// 最終確認モーダル非表示
function hideFinalConfirmModal() {
    document.getElementById('finalConfirmModal').style.display = 'none';
}

// 最終回答送信
async function submitFinalResponse() {
    if (!currentApprovalData || !currentApprovalKey) return;

    hideFinalConfirmModal();
    showLoadingOverlay(true);

    const submitData = {
        cards: currentApprovalData.cards,
        submittedAt: new Date().toISOString()
    };

    try {
        const response = await fetch(`/api/approval/${currentApprovalKey}/submit`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(submitData)
        });

        const data = await response.json();

        if (response.ok && data.success) {
            showAlert('✅', '送信完了', data.message || '承認内容を正常に送信しました。');
            disableAllInputs();
        } else {
            showAlert('❌', 'エラー', data.message || '送信に失敗しました。');
        }
    } catch (error) {
        console.error('送信エラー:', error);
        showAlert('❌', 'エラー', 'サーバーとの通信に失敗しました。');
    } finally {
        showLoadingOverlay(false);
    }
}

// 入力無効化
function disableAllInputs() {
    const buttons = document.querySelectorAll('button:not(.alert-btn)');
    const inputs = document.querySelectorAll('input');

    buttons.forEach(btn => btn.disabled = true);
    inputs.forEach(input => input.disabled = true);
}

// ユーティリティ関数
function displaySummarySection() {
    document.getElementById('summarySection').style.display = 'block';
}

function displayFinalSubmitSection() {
    document.getElementById('finalSubmitSection').style.display = 'block';
}

function showLoading(show) {
    document.getElementById('loadingSection').style.display = show ? 'block' : 'none';
}

function showLoadingOverlay(show) {
    document.getElementById('loadingOverlay').style.display = show ? 'block' : 'none';
}

function showError(message) {
    const errorSection = document.getElementById('errorMessage');
    document.getElementById('errorText').textContent = message;
    errorSection.style.display = 'block';
}

function hideError() {
    document.getElementById('errorMessage').style.display = 'none';
}

function showAlert(icon, title, message) {
    document.getElementById('alertIcon').textContent = icon;
    document.getElementById('alertTitle').textContent = title;
    document.getElementById('alertMessage').textContent = message;
    document.getElementById('alertModal').style.display = 'block';
}

function hideAlert() {
    document.getElementById('alertModal').style.display = 'none';
}

</script>
</body>
</html>
